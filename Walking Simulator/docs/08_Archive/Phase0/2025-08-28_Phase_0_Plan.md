## Phase 0 Plan — Baseline, Safety, and Handshake

**Date**: 2025-08-28  
**Owner**: Engineering  
**Status**: Active

### Scope
- Establish a safe baseline before asset/map expansion.  
- Verify tests, logging, and core gameplay entry points without changing working behavior.  
- Prepare isolated test scenes to validate inputs/interactions without touching production scenes.

### Success Criteria (Go/No-Go)
- Tests: `Tests/TestRunner.tscn` runs clean locally with current scripts.  
- Logging: `Systems/Core/GameLogger.gd` writes to `logs/` and respects `DebugConfig.gd` level and env overrides.  
- Player/Interaction: Player loads and basic interaction works in existing demo/main scenes unchanged.  
- No regressions: No edits to production scenes that alter behavior; any experiments only in dedicated test scenes.  
- Documentation: This Phase 0 document exists and lists risks, non-goals, and next steps.

### Non-Goals
- No terrain or vegetation overhauls (tracked for Phase 2+ in 2025-08-27_Asset_Planning_Updated.md).  
- No map size changes.  
- No new gameplay systems beyond test scaffolding.

### Risks & Mitigations
- Test Flakiness: Prefer deterministic inputs and timers; isolate long-running timers in tests.  
- Logging Volume: Use `GAME_LOG_LEVEL` to control verbosity in CI/local; default to INFO in routine runs.  
- Scene Coupling: Keep test scenes minimal; avoid referencing heavy production resources.

### Current Baseline Findings
- Systems present: `Systems/Core`, `Systems/NPCs`, `Systems/UI`, `Systems/Commands`, `Systems/Audio`.  
- Player & Interaction: `Player Controller/PlayerController*.gd`, `InteractionController.gd`.  
- Tests present: custom runner (`Tests/run_tests.gd`) and multiple scene/unit test files; `Tests/TestRunner.tscn` is the entry.

### Logging Configuration Plan
- Central config: `Systems/Core/DebugConfig.gd` with level and module toggles.  
- Logger: `Systems/Core/GameLogger.gd` (enum levels 0–3), file output to `logs/game_log_<timestamp>.log`.  
- Env overrides supported (examples):  
  - `GAME_LOG_LEVEL=3` for DEBUG  
  - `SCENE_DEBUGGER=1` to enable scene debugger  
  - `INPUT_DEBUG=1` to toggle input debug

Usage Recommendation:  
- Default INFO (2) for normal development.  
- DEBUG (3) only during focused troubleshooting; revert after.

### Dedicated Test Scenes (to be created)
- `Tests/test_phase0_input.tscn`: Minimal `Player` + input mapping validation.  
- `Tests/test_phase0_interaction.tscn`: `Player` + simple `InteractableObject.gd` stub.  
- `Tests/test_phase0_ui.tscn`: Mount `Systems/UI` minimal HUD for sanity.  
- `Tests/test_phase0_npc_dialogue.tscn`: NPC + dialogue UI wiring smoke test.

Note: These scenes must be isolated, light-weight, and must not modify production scenes.

### Execution Checklist
- [ ] Run `Tests/TestRunner.tscn` and confirm all tests pass.  
- [ ] Verify logger file output appears in `/logs` and respects level toggles.  
- [ ] Create the four Phase 0 test scenes listed above.  
- [ ] Document any failures or regressions; fix only within test stubs unless critical.

### Handshake for Phase 1 (Minimal-Change Plan)
- Target: Small, reversible improvements (e.g., input/controller refactor guardrails, small UI prompt tweaks) guarded by feature flags.  
- All changes must come with a dedicated test scene or unit test and pass the baseline criteria above.

### Phase 1 — Minimal-Change Plan (Draft)
- Feature flagging: add `Systems/Core/DebugConfig.gd` toggles or `ProjectSettings` keys for new behavior switches.
- Player controller safety:
  - Introduce `PlayerControllerRefactored.gd` behind a flag; default to existing controller.  
  - Add test: extend `Tests/test_phase0_input.tscn` to compare movement inputs between controllers.
- Interaction prompts:
  - Make prompt style/config driven; add a small visual tweak guarded by a flag.  
  - Test: `Tests/test_phase0_interaction.tscn` verifies prompt show/hide events.
- UI stability:
  - Ensure `CulturalInfoPanel` can be toggled via a flag for revised layout.  
  - Test: `Tests/test_phase0_ui.tscn` confirms load and minimal signal flow.
- Logging polish:
  - Add a `perf_trace` helper in `GameLogger` gated by `ENABLE_PERF_TRACE` flag (defaults off).

Success criteria for Phase 1:  
- All flags default to legacy behavior; no regressions in main scenes.  
- New tests pass in headless mode.  
- Rollback: disabling flags restores current behavior without code edits.


